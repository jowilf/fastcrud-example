{% extends "layout.html" %} {%set pk = model.pk()%} {% block header %}
<div class="d-flex justify-content-between align-items-center">
  <h1>{{ model.get_name() }}</h1>
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <a href="{{ admin_url()}}">Admin</a>
    </li>
    <li class="breadcrumb-item">
      <a href="{{ admin_url_for(model) }}">{{ model.get_name() }}</a>
    </li>
    <li class="breadcrumb-item active">Detail</li>
  </ol>
</div>
{% endblock %} {% block modal %} {% include "modals/loading.html" %} {% include
"modals/error.html" %} {% include "modals/confirm_delete.html" %} {% endblock %}
{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center">
              <h3 class="card-title">
                {{pk | upper}}: <strong>{{ value[pk] }}</strong>
              </h3>
              <div class="d-flex">
                <a href="{{ admin_url_for(model, 'edit', value[pk])}}">
                  <button type="button" class="btn btn-primary btn-block me-2">
                    <i class="fa-solid fa-edit me-2"></i>
                    Edit
                  </button>
                </a>
                <button
                  id="delete-btn"
                  type="button"
                  class="btn btn-danger btn-block"
                  data-bs-toggle="modal"
                  data-bs-target="#modal-delete"
                >
                  <i class="fas fa-trash-alt me-2"></i>
                  Delete
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="card-body">
          {% set columns= model.cols() %} {% for key in columns if not
          columns[key].exclude_from_view %} {% set item = value[key] %}
          <div>
            <strong>{{ key | title }}</strong>
          </div>
          {% if value[key] == None %}
          <p class="text-muted">{{"-null-" }}</p>
          {% elif columns[key].type == "image" %} {% if not
          columns[key].is_array %} {% set item = [item] %} {% endif %}
          <div class="d-flex">
            {% for image in item %}
            <div class="mx-1 my-2">
              <img
                style="width: 5em; height: 5em; object-fit: cover"
                src="{{ file_url(image.path) }}"
                class="img-fluid rounded me-3 d-block"
                alt="{{ image.filename }}"
              />
            </div>
            {% endfor %}
          </div>
          {% elif columns[key].type == "file" %} {% if not columns[key].is_array
          %} {% set item = [item] %} {% endif %}
          <div class="d-flex flex-column">
            {% for file in item %}
            <a href="{{ file_url(file.path) }}" class="btn-link"
              ><i class="fas fa-fw {{ file.content_type | file_icon }}"></i> {{
              file.filename }}</a
            >
            {% endfor %}
          </div>
          {% elif columns[key].type == 'relation' %} {% if not columns[key].many
          %} {% set item = [item] %} {% endif %} {% if item | length == 0 %}
          <p class="text-muted">{{"-empty-" }}</p>
          {% else %}
          <div class="d-flex flex-row">
            {% for v in item %} {% set foreign_model = (columns[key].identity |
            to_model) %}
            <a
              class="m-1 btn-link"
              href="{{ admin_url_for(foreign_model, 'show', v[foreign_model.pk()])}}"
              class="text-nowrap"
              ><span class="avatar rounded-circle">{{ v[pk] }}</span></a
            >
            {% endfor %}
          </div>
          {% endif %} {% elif columns[key].is_array %}
          <ul>
            {% for v in item %}
            <li>{{v }}</li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="">{{ item.type }} {{ value[key] }}</p>
          {% endif %} {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block script_end %}
<script>
  $(function(){
      $("#modal-delete-btn").click(function(){
          $("#modal-delete").modal('hide');
          $("#modal-loading").modal('show');
          fetch(`{{ ds(model) | safe}}?where=${JSON.stringify({{'{'+pk}}: {{value[pk]}}})}`, {
              method: "DELETE",
              headers: {{ajax_headers() | safe}},
          }).then(async response=>{
              if(response.ok){
              await new Promise(r => setTimeout(r, 500));
                  $("#modal-loading").modal('hide')
                  window.location.replace("{{ admin_url_for(model)  | safe}}")
              }
              else
                  return Promise.reject();

          }).catch(async (error) => {
              await new Promise(r => setTimeout(r, 500));
              $("#modal-loading").modal('hide')
              $("#modal-error").modal('show');
          });
      });
  })
</script>
{% endblock %}
